# План масштабирования в SaaS (Pay-per-Resume)

**Цель:** Трансформировать клиентское приложение (MVP) в коммерческий сервис, где пользователи регистрируются, сохраняют свои резюме в облаке и оплачивают скачивание готового PDF файла.

**Модель монетизации:** Freemium / Pay-wall.
1.  Создание и редактирование — **Бесплатно**.
2.  Скачивание PDF (или скачивание без водяного знака) — **Платная услуга** (разовый платеж за резюме).

---

## 1. Обновление Технологического Стека (Fullstack)
Нам нужно добавить серверную часть и базу данных. Так как мы используем Next.js, мы остаемся в рамках одной экосистемы.

*   **Database (База Данных):** [PostgreSQL](https://www.postgresql.org/).
    *   *Провайдер:* **Supabase** или **Neon** (облачные, масштабируемые, есть бесплатные тарифы для старта).
*   **ORM (Работа с БД):** [Prisma](https://www.prisma.io/).
    *   *Зачем:* Упрощает запись и чтение данных из базы. Позволяет описать схему данных (Schema) в одном файле.
*   **Authentication (Вход в систему):** [Clerk](https://clerk.com/) или [NextAuth.js](https://next-auth.js.org/).
    *   *Рекомендация:* **Clerk**. Он берет на себя всё: форму входа, восстановление пароля, защиту профиля, Google Login. Это экономит недели разработки.
*   **Payments (Платежи):** [Stripe](https://stripe.com/).
    *   *Инструмент:* **Stripe Checkout**. Готовая страница оплаты, которую не нужно верстать самому.

---

## 2. Пошаговый Roadmap внедрения SaaS

### Фаза 1: База данных и Авторизация
Пользователь должен иметь возможность зайти в личный кабинет и увидеть свои сохраненные черновики.

- [ ] **Настройка БД:** Развернуть PostgreSQL на Supabase.
- [ ] **Интеграция Prisma:**
    - Описать модель `User` (id, email, stripeCustomerId).
    - Описать модель `Resume` (id, userId, title, dataJson, isPaid).
- [ ] **Интеграция Clerk:**
    - Обернуть приложение в провайдер авторизации.
    - Создать защищенные маршруты (например, `/dashboard` доступен только после входа).
- [ ] **API Endpoints:**
    - Реализовать API для сохранения резюме (`POST /api/resumes/save`).
    - Реализовать API для загрузки списка резюме (`GET /api/resumes`).

### Фаза 2: Личный кабинет (Dashboard)
Место, где пользователь управляет документами.

- [ ] **Страница Dashboard:**
    - Список созданных резюме (карточки с названием и датой).
    - Кнопка "Создать новое" (обнуляет стейт редактора).
    - Кнопки "Редактировать" и "Удалить" на карточках.
- [ ] **Синхронизация:** При открытии редактора данные должны подтягиваться не из LocalStorage, а из базы данных по ID резюме.

### Фаза 3: Интеграция Платежей (Stripe)
Самый ответственный этап.

- [ ] **Настройка Stripe:**
    - Создать аккаунт.
    - Создать продукт "Premium Resume Download" (цена, например, $2.99).
- [ ] **Логика блокировки:**
    - В редакторе кнопка "Скачать PDF" должна быть заблокирована или помечена иконкой замка.
    - При клике -> открывается модальное окно: "Оплатите, чтобы скачать профессиональный PDF".
- [ ] **Процесс оплаты:**
    - Создать API Route `/api/checkout`, который создает сессию Stripe и возвращает ссылку на оплату.
    - Перенаправить пользователя на Stripe.
- [ ] **Webhooks (Вебхуки):**
    - Создать API Route `/api/webhooks/stripe`.
    - Логика: Когда Stripe сообщает "Оплата прошла успешно" -> Найти резюме в БД -> Поменять поле `isPaid` на `true`.

### Фаза 4: Генерация PDF на сервере (Повышение качества)
*Опционально для старта, но важно для качества.*
Если пользователь платит, он не хочет возиться с настройками принтера.

- [ ] **Puppeteer / Playwright:**
    - Развернуть микросервис или Serverless функцию, которая запускает скрытый браузер.
    - Функция открывает уникальную ссылку с резюме, генерирует PDF и возвращает файл пользователю.
    - Это гарантирует, что PDF выглядит идеально на любом устройстве пользователя.

### Фаза 5: Деплой и Продакшн
Выход в свет.

- [ ] **Хостинг:** Деплой проекта на **Vercel** (идеально для Next.js).
- [ ] **Environment Variables:** Настройка ключей API (Stripe Secret Key, Database URL) в панели Vercel. Никогда не хранить их в коде!
- [ ] **Домен:** Покупка домена (например, `pro-resume.com`) и привязка к Vercel.

---

## 3. Схема базы данных (Prisma Schema Example)
Сохрани это как ориентир для структуры БД.

```prisma
// schema.prisma

model User {
  id        String   @id @default(cuid()) // ID от Clerk
  email     String   @unique
  createdAt DateTime @default(now())
  resumes   Resume[] // Связь: один юзер - много резюме
}

model Resume {
  id        String   @id @default(cuid())
  title     String   @default("My Resume")
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  // Здесь хранится весь JSON с опытом, школами и т.д.
  content   Json     
  
  // Статус оплаты
  isPaid    Boolean  @default(false) 
  paymentId String?  // ID транзакции Stripe
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


4. Юридические моменты (Важно!)
Для приема платежей на сайте обязательно нужны эти страницы (требование платежных систем):

Terms of Service (Условия использования): Правила сервиса.
Privacy Policy (Политика конфиденциальности): Как вы храните данные (email, телефоны).
Refund Policy (Политика возврата): Что делать, если PDF сгенерировался криво (обычно возврат средств).


### С чего начать SaaS трансформацию?
Не пытайся делать всё сразу. Сначала заверши **MVP** (чтобы редактор работал идеально локально). Только когда у тебя будет готовый продукт, который *можно* продавать, начинай прикручивать базу данных и оплату (Фаза 1 данного плана).